name: DCO Signoff Check

on: [pull_request]

jobs:
  check-signoffs:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Check for unsigned commits
        run: |
          # Get the list of commits in this PR
          commits=$(git rev-list --no-merges origin/${{ github.base_ref }}..${{ github.head_ref }})
          
          # Check each commit for signoff
          for commit in $commits; do
            # Check if commit message contains "Signed-off-by:"
            signoff_count=$(git show -s --format='%B' $commit | grep -c "Signed-off-by:")
            
            if [ "$signoff_count" -eq 0 ]; then
              echo "::error::Commit $commit is not signed off! Please use 'git commit -s'."
              exit 1
            fi
          done
          echo "All commits are signed off."